# Manually collect EGL_Component source files, avoid including 3rdparty directory files to prevent MSVC compilation errors
file(GLOB_RECURSE EGL_SOURCES 
    "*.cpp"
    "*.c"
)

# Exclude all files in 3rdparty directory
list(FILTER EGL_SOURCES EXCLUDE REGEX "3rdparty/.*")

# Exclude specific files
list(REMOVE_ITEM EGL_SOURCES
    "${CMAKE_CURRENT_SOURCE_DIR}/ModelLoader/ModelLoader_Universal.cpp"
    "${CMAKE_CURRENT_SOURCE_DIR}/ModelLoader/ModelLoader_Universal.hpp"
)

# Define this component as a library
add_library(EGL_Component ${EGL_SOURCES})

# Macro definitions
target_compile_definitions(EGL_Component PRIVATE ENABLE_INSTANCING)

# Header file search paths for this library PUBLIC: means any target that links EGL_Component will automatically get this header file path
# CMAKE_CURRENT_SOURCE_DIR represents the directory where the current CMakelists.txt is located
target_include_directories(EGL_Component PUBLIC 
                            ${CMAKE_CURRENT_SOURCE_DIR} 
                            ${CMAKE_CURRENT_SOURCE_DIR}/3rdparty/assimp/include
                            ${CMAKE_CURRENT_SOURCE_DIR}/3rdparty
                            ${CMAKE_CURRENT_SOURCE_DIR}/3rdparty/SOIL2
                            ${CMAKE_CURRENT_SOURCE_DIR}/3rdparty/glad/include
                            ${CMAKE_CURRENT_SOURCE_DIR}/3rdparty/glfw/include
                            ${CMAKE_CURRENT_SOURCE_DIR}/component
                            ${CMAKE_CURRENT_SOURCE_DIR}/Common
                            ${CMAKE_CURRENT_SOURCE_DIR}/Component_FBO
                            ${CMAKE_CURRENT_SOURCE_DIR}/Component_3DModels
                            ${CMAKE_CURRENT_SOURCE_DIR}/Component_Offscreen
                            ${CMAKE_CURRENT_SOURCE_DIR}/Component_LoadingView
                            ${CMAKE_CURRENT_SOURCE_DIR}/Component_Shader_Blinn_Phong
                            ${CMAKE_CURRENT_SOURCE_DIR}/ModelLoader
                            ${CMAKE_CURRENT_SOURCE_DIR}/Component_Camera
                            ${CMAKE_CURRENT_SOURCE_DIR}/Component_Silhouette
                            ${CMAKE_CURRENT_SOURCE_DIR}/Component_Mouse
                            ${CMAKE_CURRENT_SOURCE_DIR}/Component_UBO
                            ${CMAKE_CURRENT_SOURCE_DIR}/Component_Box
                            ${CMAKE_CURRENT_SOURCE_DIR}/Component_Instancing
                            ${CMAKE_CURRENT_SOURCE_DIR}/Component_Skybox
                            ${CMAKE_CURRENT_SOURCE_DIR}/Component_TextureManager
                            )

# GLAD library
add_subdirectory(3rdparty/glad)
# Assimp library
add_subdirectory(3rdparty/assimp)
# GLFW library
add_subdirectory(3rdparty/glfw)
# SOIL2 library
add_subdirectory(3rdparty/SOIL2)

# EGL_Component has its own dependent libraries; any target that links EGL_Component will automatically link these libraries
if(MSVC)
    target_link_libraries(EGL_Component 
                        PUBLIC 
                        OpenGL::GL
                        ${CMAKE_CURRENT_SOURCE_DIR}/3rdparty/assimp/windows-x64-msvc/assimp-vc143-mtd.lib
                        ${CMAKE_CURRENT_SOURCE_DIR}/3rdparty/assimp/windows-x64-msvc/zlib.lib
                        glfw
                        glad
                        SOIL2
                        )
else()
    # For MinGW and other compilers, use the built libraries
    target_link_libraries(EGL_Component 
                        PUBLIC 
                        OpenGL::GL
                        assimp
                        zlib
                        glfw
                        glad
                        SOIL2
                        )
endif()

